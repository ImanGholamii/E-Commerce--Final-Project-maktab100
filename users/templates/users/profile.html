<!DOCTYPE html>
{% load i18n %}
{% load static %}
<html lang="{% trans 'en' %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans 'User Profile' %}</title>

    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
    <script src="{% static 'js/script.js' %}"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.6.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.6.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"
            integrity="sha384-GLhlTQ8iKUr/C2r/+MJYEhjr8ue8qLjz/6CS70C2N5F5tr5ww0DZa4FfNFMlRT"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>


</head>
<body style="background-image: url('{% static 'images/profile-bg.jpg' %}'); background-size: cover; color: #fff;">
<div class="profile-container">
    <div class="profile-image">
        {#        {% if user_profile.profile_picture and user_profile.profile_picture.url %}#}
        {% if user_profile.profile_picture or user_profile.profile_picture.url %}
            {#            <img src="{{ user_profile.profile_picture.url }}" alt="{% trans 'Profile Picture' %}">#}
            <img src="{{ user_profile.profile_picture }}" alt="{% trans 'Profile Picture' %}">
        {% else %}
            <p>{% trans 'No Profile Picture available' %}</p>
        {% endif %}
        {#        <p>{{ user_profile.user.username }}</p>#}
        <p>{{ user_data.username }}</p>
        <div class="column">
            {#            <h2>{{ user_profile.user.first_name }} {{ user_profile.user.last_name }}</h2>#}
            <h2>{{ user_data.first_name }} {{ user_data.last_name }}</h2>
            {#            <p>{% trans 'Email' %}: {{ user_profile.user.email }}</p>#}
            <p>{% trans 'Email' %}: {{ user_data.email }}</p>
            {#            <p>{% trans 'Phone Number' %}: {{ user_profile.user.phone }}</p>#}
            <p>{% trans 'Phone Number' %}: {{ user_data.phone }}</p>
            {#            <p>{% trans 'Gender' %}: {{ user_profile.get_gender_display }}</p>#}
            <p>{% trans 'Gender' %}: {{ user_profile.gender }}</p>
            <p>{% trans 'Date of Birth' %}: {{ user_profile.date_of_birth }}</p>
            <p>{% trans 'Social Media' %}: {{ user_profile.social_media }}</p>
        </div>
    </div>
    <div class="profile-details">
        <div class="column">
            <h2>{% trans 'Interests' %}</h2>
            <p>{{ user_profile.interests }}</p>
            <h2>{% trans 'Bio' %}</h2>
            <p>{{ user_profile.bio }}</p>
            <h2>{% trans 'Address' %}</h2>
            {#            <ul>#}
            {#                {% for addr in address %}#}
            {#                    <div class="address">#}
            {#                        {% if addr.is_default %}#}
            {#                            <span>{{ forloop.counter }}. &nbsp;{% trans 'Default: ' %} {{ addr }}</span>#}
            {#                        {% else %}#}
            {#                            <span>{{ forloop.counter }}. &nbsp;{{ addr }}</span>#}
            {#                        {% endif %}#}
            {#                        &nbsp;#}
            {#                        &nbsp;#}
            {#                        &nbsp;#}
            {#                        <button class="btn btn-danger btn-sm delete-address-btn rounded-circle"#}
            {#                                style="width: 35px; height: auto;" data-address-id="{{ addr.id }}">#}
            {#                            <i class="bi bi-trash-fill"></i>#}
            {#                        </button>#}
            {#                    </div>#}
            {#                {% endfor %}#}
            {#            </ul>#}
            {% for address in user_address %}
                {% for key, value in address.items %}
                    {% if forloop.counter > 1 %}
                        {% if key == 'is_default' %}
                            {% if value %}
                                <span>Default&nbsp;</span>
                            {% else %}
                                <span></span>
                            {% endif %}
                        {% else %}
                            {% if key == 'state' %}
                                <span>{{ forloop.parentloop.counter }}.</span>&nbsp;
                            {% endif %}
                            {% if key != 'user' %}
                                <span>{% trans key %}: {{ value }} </span>&nbsp;
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
                <button class="btn btn-danger btn-sm delete-address-btn rounded-circle"
                        style="width: 35px; height: auto;" data-address-id="{{ address.id }}">
                    <i class="bi bi-trash-fill"></i>
                </button>
                <button class="btn btn-info btn-sm update-address-btn rounded-circle"
                        style="width: 35px; height: auto;"
                        data-address-id="{{ address.id }}"
                        onclick="openEditAddressForm('{{ address.id }}');">
                    <i class="bi bi-pencil-fill"></i>
                </button>

                <!-- HTML -->
                <style>/* CSS */
                #overlay {
                    position: fixed;
                    top: 0;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background-color: rgba(0, 0, 0, 0.5); /* opacity برای سایه پس زمینه */
                    z-index: 1000; /* بر روی همه‌ی دیگر المان‌ها */
                    display: none; /* ابتدا مخفی است */
                }

                #popup {
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #fff;
                    padding: 20px;
                    border-radius: 5px;
                    z-index: 1001; /* بالاتر از overlay */
                    display: none; /* ابتدا مخفی است */
                }
                </style>
                <div id="overlay"></div>
                <div id="popup">
                    <div id="addressFormTemplate" style="display: none;">
                        <form id="editAddressForm">
                            {% csrf_token %}
                            {{ address_form.as_p }}
                            <button type="submit" class="btn btn-primary">{% trans 'Save Changes' %}</button>
                        </form>
                    </div>
                </div>


                <hr style="color: red; margin-bottom: 5px">
            {% endfor %}
        </div>
    </div>
    <div class="column">
        <div class="edit-profile-button">
            <button class="btn btn-warning mt-3" style="padding: 0 3px;">
                <a class="btn-edit" href="{% url 'edit_profile' %}">{% trans 'Edit Profile' %}</a></button>
        </div>
        <div class="edit-profile-button">
            <button class="btn btn-warning mt-3" style="padding: 0 3px;
            background-color: #a8a8a8">
                <a class="btn-edit" href="{% url 'index' %}">{% trans 'Back' %}</a></button>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $('.delete-address-btn').click(function () {
        var addressId = $(this).data('address-id');
        $.ajax({
            type: 'POST',
            url: '{% url "delete_address" pk=0 %}'.replace('0', addressId),
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function () {

                alert('Address deleted successfully!');
            },
            error: function () {
                alert('An error occurred while deleting the address.');
            }
        });
    });
</script>
<script>
    {#function openEditAddressForm(addressId) {#}
    {#    var editUrl = "/address/update/" + addressId + "/";#}
    {#    var editForm = document.getElementById("addressFormTemplate").cloneNode(true);#}
    {##}
    {#    document.body.appendChild(editForm);#}
    {##}
    {#    editForm.style.display = "block";#}
    {#    editForm.querySelector('input[name="address_id"]').value = addressId;#}
    // JavaScript
    function openEditAddressForm(addressId) {
        var editUrl = "/address/update/" + addressId + "/";
        var editForm = document.getElementById("addressFormTemplate").cloneNode(true);
        var overlay = document.getElementById("overlay");
        var popup = document.getElementById("popup");

        // فرم را به بدنه اضافه کنید
        document.body.appendChild(editForm);

        // نمایش overlay و popup
        overlay.style.display = "block";
        popup.style.display = "block";

        // تنظیم موقعیت فرم در وسط صفحه
        popup.style.top = "50%";
        popup.style.left = "50%";
        popup.style.transform = "translate(-50%, -50%)";

        // برای بستن فرم، کلیک بروی overlay را مدیریت کنید
        overlay.addEventListener("click", closeEditAddressForm);

        // تنظیم آی‌دی آدرس در فرم
        editForm.querySelector('input[name="address_id"]').value = addressId;
    }

    function closeEditAddressForm() {
        var overlay = document.getElementById("overlay");
        var popup = document.getElementById("popup");
        var editForm = document.getElementById("addressFormTemplate");

        // مخفی کردن overlay و popup
        overlay.style.display = "none";
        popup.style.display = "none";

        // حذف فرم از بدنه
        editForm.parentNode.removeChild(editForm);

        // حذف event listener برای بستن فرم با کلیک
        overlay.removeEventListener("click", closeEditAddressForm);
    }

</script>

</body>
</html>
